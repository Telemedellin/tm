function modificar_url(a,b){b=b||null,Modernizr.history&&window.history.pushState({pagina:b},null,a)}function makeTitle(a){for(var b,c=a.split("-"),d=0,e=c.length;e>d;d++)b=c[d],c[d]=b.charAt(0).toUpperCase()+b.slice(1);return c.join(" ")}function back(a){for(var b=window.location.hash.split("/"),c="",d=0,e=b.length-1;e>d;d++)c+=b[d]+"/";c=c.substring(0,c.length-1),window.location.hash=c,a.preventDefault(),ga_track()}function ga_track(){ga("send","event","Archivos","Click",location.pathname+"/"+location.hash)}function track_file(a){ga_track("send","event","Archivos","Click",a.currentTarget.href)}jQuery(function(a){var b="/";window.Carpeta=Backbone.Model.extend({urlRoot:b+"api/carpeta",defaults:{id:"",url:"",pagina:"",carpeta:"",ruta:"",hijos:""}}),window.Archivo=Backbone.Model.extend({urlRoot:b+"api/archivo",defaults:{id:"",url:"",tipo_archivo:"",carpeta:"",nombre:"",archivo:""}}),window.Pagina=Backbone.Model.extend({urlRoot:b+"api/pagina",defaults:{id:"",nombre:""}}),window.CarpetaCollection=Backbone.Collection.extend({model:Carpeta,url:b+"api/carpeta"}),window.ArchivoCollection=Backbone.Collection.extend({model:Archivo,url:b+"api/archivo"});var c=function(b){return _.template(a("#"+b).html())};window.CarpetaListView=Backbone.View.extend({template:c("carpetaListViewTemplate"),initialize:function(){this.collection.bind("reset",this.render,this),this.collection.bind("add",this.render,this),this.render},render:function(){return this.$el.empty(),a(this.el).html(this.template(this.model.toJSON())),_.each(this.collection.models,function(b){a(".carpetas").append(new CarpetaListItemView({model:b}).render().el).fadeIn("slow")},this),this}}),window.CarpetaListItemView=Backbone.View.extend({tagName:"li",className:"carpeta",template:c("carpetaListItemViewTemplate"),render:function(){return a(this.el).html(this.template(this.model.toJSON())),a("#micrositio").hasClass("mCustomScrollbar")&&window.updateScrollbar(),this},close:function(){a(this.el).unbind(),a(this.el).remove()}}),window.ArchivoListView=Backbone.View.extend({template:c("archivoListViewTemplate"),initialize:function(){this.collection.bind("reset",this.render,this),this.render(),this.collection.bind("add",this.add,this)},render:function(){return this.$el.empty(),a(this.el).html(this.template(this.model)),this},add:function(b){var c=new ArchivoListItemView({model:b});a(".archivos").append(c.render().el).fadeIn("slow")}}),window.ArchivoListItemView=Backbone.View.extend({tagName:"li",className:"archivo",template:c("archivoListItemViewTemplate"),render:function(){return a(this.el).html(this.template(this.model.toJSON())),a("#micrositio").hasClass("mCustomScrollbar")&&window.updateScrollbar(),this},events:{"click a":"ver"},close:function(){a(this.el).unbind().remove()},ver:function(a){var c,d,e;void 0!==a.currentTarget.dataset?(c=a.currentTarget.dataset.carpeta,d=a.currentTarget.dataset.archivo,e=a.currentTarget.dataset.nombre):(c=a.currentTarget.getAttribute("data-carpeta"),d=a.currentTarget.getAttribute("data-archivo"),e=a.currentTarget.getAttribute("data-nombre")),window.open(b+"archivos/"+c+"/"+d),a.preventDefault()}}),window.ArchivoItemView=Backbone.View.extend({className:"detalle_archivo",template:c("archivoItemViewTemplate"),render:function(){return a(this.el).html(this.template(this.model.toJSON())),this}});var d=Backbone.Router.extend({routes:{archivos:"listar","archivos/:a1(/:a2)(/:a3)(/:a4)(/:a5)":"listarCarpeta"},initialize:function(){var b=new RegExp("(/)+$","g");this.route(/(.*)\/+$/,"trailFix",function(a){this.navigate(a.replace(b,""),!0)}),this.pagina=new Pagina,this.pagina_id=a("#micrositio").data("pagina-id"),this.pagina.fetch({data:{id:this.pagina_id}}),""==window.location.hash&&(window.location.hash="archivos")},listar:function(){this.carpetaList=new CarpetaCollection,this.carpetaList.fetch({data:{pagina_id:this.pagina_id}}),this.carpetaListView=new CarpetaListView({collection:this.carpetaList,model:this.pagina}),a("#ccontainer").html(this.carpetaListView.render().el),ga_track()},listarCarpeta:function(){var b=a("#ccontainer");b.append('<div id="loading"><span class="spinner"></span></div>').fadeIn("slow"),this.carpetaList=new CarpetaCollection,this.carpetaList.fetch({data:{hash:window.location.hash},success:function(){a("#loading").remove()}}),this.archivoList=new ArchivoCollection,this.archivoList.fetch({data:{hash:window.location.hash}}),this.carpetaListView=new CarpetaListView({collection:this.carpetaList,model:this.pagina}),this.archivoListView=new ArchivoListView({collection:this.archivoList,model:this.pagina}),0==a("#archivos").length&&b.html('<a href="#archivos" class="back">Volver</a>'),b.append(this.carpetaListView.render().el).append(this.archivoListView.render().el),ga_track()}});new d,Backbone.history.start(),a(document).on("click",".back",back),a(document).on("click",".archivo a",track_file)});
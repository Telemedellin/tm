"use strict";function modificar_url(a,b){if(b||(b=null),Modernizr.history){var c={pagina:b};window.history.pushState(c,null,a)}}jQuery(function(a){window.c=0,window.slider,window.Album=Backbone.Model.extend({urlRoot:"/tm/api/fotoalbum",defaults:{id:"",nombre:"",url:"",thumb:""}}),window.Foto=Backbone.Model.extend({urlRoot:"/tm/api/foto",defaults:{id:"",nombre:"",album_foto:"",url:"",src:"",thumb:"",ancho:"",alto:""}}),window.Micrositio=Backbone.Model.extend({urlRoot:"/tm/api/micrositio",defaults:{id:"",nombre:""}}),window.AlbumCollection=Backbone.Collection.extend({model:Album,url:"/tm/api/fotoalbum"}),window.FotoCollection=Backbone.Collection.extend({model:Foto,url:"/tm/api/foto"});var b=function(b){return _.template(a("#"+b).html())};window.AlbumListView=Backbone.View.extend({template:b("albumListViewTemplate"),initialize:function(){this.collection.bind("reset",this.render,this),this.collection.bind("add",this.render,this),this.render},render:function(){return a(this.el).html(this.template(this.model.toJSON())),_.each(this.collection.models,function(b){a(".albumes").append(new AlbumListItemView({model:b}).render().el)},this),this}}),window.AlbumListItemView=Backbone.View.extend({tagName:"li",className:"album",template:b("albumListItemViewTemplate"),render:function(){return a(this.el).html(this.template(this.model.toJSON())),this},close:function(){a(this.el).unbind(),a(this.el).remove()}}),window.FotoListView=Backbone.View.extend({className:"galeria",template:b("fotoListViewTemplate"),initialize:function(){this.collection.bind("reset",this.render,this),this.render(),this.collection.bind("add",this.add,this)},render:function(){return a(this.el).html(this.template(this.model)),this},add:function(b){var c=new FotoListItemView({model:b});a(".fotos").append(c.render().el),b.attributes.url=="#"+Backbone.history.fragment&&a(".foto a."+b.attributes.id).trigger("click"),window.c<=0&&(window.slider=a(".fotos").bxSlider({pager:!1,minSlides:10,maxSlides:20,slideWidth:100,slideMargin:8,viewportWidth:"100%"}),a(".foto a."+b.attributes.id).trigger("click")),window.c+=1}}),window.FotoListItemView=Backbone.View.extend({tagName:"li",className:"foto",template:b("fotoListItemViewTemplate"),render:function(){return a(this.el).html(this.template(this.model.toJSON())),this},events:{"click a":"ver"},close:function(){a(this.el).unbind(),a(this.el).remove()},ver:function(b){var c=b.currentTarget.dataset.src;a(".full").html('<img src="'+c+'" /><h2>'+b.currentTarget.dataset.nombre+"</h2>"),modificar_url(b.currentTarget.href,b.currentTarget.dataset.nombre),a('<div class="expander"></div>').appendTo(".full").click(function(){screenfull.enabled&&(screenfull.toggle(a(".fancybox-outer")[0]),a(".fancybox-outer").toggleClass("fullscreen"))}),b.preventDefault()}});var c=Backbone.Router.extend({routes:{imagenes:"listarAlbumes","imagenes/:album(/:foto)":"listarFotos"},initialize:function(){this.micrositio=new Micrositio,this.micrositio_id=a("#micrositio").data("micrositio-id"),this.micrositio.fetch({data:{id:this.micrositio_id}})},listarAlbumes:function(){this.albumList=new AlbumCollection,this.albumList.fetch({data:{micrositio_id:this.micrositio_id}}),this.albumListView=new AlbumListView({collection:this.albumList,model:this.micrositio}),a("#icontainer").html(this.albumListView.render().el)},listarFotos:function(b,c){this.fotoList=new FotoCollection,this.fotoList.fetch({data:{nombre:b,micrositio:this.micrositio_id}});var d=b.charAt(0).toUpperCase();b=d+b.substring(1),this.fotoListView=new FotoListView({collection:this.fotoList,model:{nombre:b,foto_activa:c}}),a("#icontainer").html(this.fotoListView.render().el)}});new c,Backbone.history.start()});
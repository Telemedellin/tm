"use strict";function modificar_url(a,b){if(b||(b=null),Modernizr.history){var c={pagina:b};window.history.pushState(c,null,a)}}jQuery(function(a){window.Album=Backbone.Model.extend({urlRoot:"/tm/api/fotoalbum",defaults:{id:"",nombre:"",url:"",thumb:""}}),window.Foto=Backbone.Model.extend({urlRoot:"/tm/api/foto",defaults:{id:"",nombre:"",album_foto:"",src:"",thumb:"",ancho:"",alto:""}}),window.AlbumCollection=Backbone.Collection.extend({model:Album,url:"/tm/api/fotoalbum"}),window.FotoCollection=Backbone.Collection.extend({model:Foto,url:"/tm/api/foto"});var b=function(b){return _.template(a("#"+b).html())};window.AlbumListView=Backbone.View.extend({tagName:"ul",className:"albumes",initialize:function(){this.collection.bind("reset",this.render,this);var b=this;this.collection.bind("add",function(c){a(b.el).append(new AlbumListItemView({model:c}).render().el)})},render:function(){return _.each(this.collection.models,function(b){a(this.el).append(new AlbumListItemView({model:b}).render().el)},this),this}}),window.AlbumListItemView=Backbone.View.extend({tagName:"li",className:"album",template:b("albumListItemViewTemplate"),render:function(){return a(this.el).html(this.template(this.model.toJSON())),this},close:function(){a(this.el).unbind(),a(this.el).remove()}}),window.FotoListView=Backbone.View.extend({tagName:"ul",template:b("fotoListViewTemplate"),initialize:function(){this.collection.bind("reset",this.render,this);var b=this;this.collection.bind("add",function(c){a(b.el).append(new FotoListItemView({model:c}).render().el)})},events:{"click a.back":"back"},render:function(){return _.each(this.collection.models,function(b){a(this.el).append(new FotoListItemView({model:b}).render().el)},this),this},back:function(a){a.preventDefault(),window.history.back()}}),window.FotoListItemView=Backbone.View.extend({tagName:"li",template:b("fotoListItemViewTemplate"),render:function(){return a(this.el).html(this.template(this.model.toJSON())),this},events:{"click a":"ver"},close:function(){a(this.el).unbind(),a(this.el).remove()},ver:function(a){a.preventDefault()}});var c=Backbone.Router.extend({routes:{imagenes:"listarAlbumes","imagenes/:album(/:foto)":"listarFotos"},initialize:function(){this.albumList=new AlbumCollection,this.fotoList=new FotoCollection,this.micrositio_id=a("#micrositio").data("micrositio-id")},listarAlbumes:function(){this.albumList.fetch({data:{micrositio_id:this.micrositio_id}}),this.albumListView=new AlbumListView({collection:this.albumList}),a("#icontainer").html(this.albumListView.render().el)},listarFotos:function(b){this.fotoList.fetch({data:{nombre:b}});var c=b.charAt(0).toUpperCase();b=c+b.substring(1),this.foto=this.fotoList.where({album_foto:b}),this.fotoListView=new FotoListView({collection:this.fotoList}),a("#icontainer").html(this.fotoListView.render().el)}});new c,Backbone.history.start()});
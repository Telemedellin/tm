function modificar_url(a,b){if(b||(b=null),Modernizr.history){var c={pagina:b};window.history.pushState(c,null,a)}}function makeTitle(a){for(var b=a.split("-"),c=0;c<b.length;c++){var d=b[c];b[c]=d.charAt(0).toUpperCase()+d.slice(1)}return b.join(" ")}jQuery(function(a){window.cv=0,window.cva=0,window.slider,window.Album=Backbone.Model.extend({urlRoot:"/api/fotoalbum",defaults:{id:"",nombre:"",url:"",thumb:""}}),window.Foto=Backbone.Model.extend({urlRoot:"/api/foto",defaults:{id:"",nombre:"",album_foto:"",url:"",src:"",thumb:"",ancho:"",alto:""}}),window.VideoAlbum=Backbone.Model.extend({urlRoot:"/api/videoalbum",defaults:{id:"",nombre:"",url:"",thumb:""}}),window.Video=Backbone.Model.extend({urlRoot:"/api/video",defaults:{id:"",nombre:"",descripcion:"",album_video:"",proveedor_video:"",url_video:"",id_video:"",url:"",duracion:"",thumbnail:""}}),window.Micrositio=Backbone.Model.extend({urlRoot:"/api/micrositio",defaults:{id:"",nombre:""}}),window.AlbumCollection=Backbone.Collection.extend({model:Album,url:"/api/fotoalbum"}),window.FotoCollection=Backbone.Collection.extend({model:Foto,url:"/api/foto"}),window.VideoAlbumCollection=Backbone.Collection.extend({model:VideoAlbum,url:"/api/videoalbum"}),window.VideoCollection=Backbone.Collection.extend({model:Video,url:"/api/video"});var b=function(b){return _.template(a("#"+b).html())};window.AlbumListView=Backbone.View.extend({template:b("albumListViewTemplate"),initialize:function(){this.collection.bind("reset",this.render,this),this.collection.bind("add",this.render,this),this.render},render:function(){return a(this.el).html(this.template(this.model.toJSON())),_.each(this.collection.models,function(b){a(".albumes").append(new AlbumListItemView({model:b}).render().el).fadeIn("fast")},this),this}}),window.AlbumListItemView=Backbone.View.extend({tagName:"li",className:"album",template:b("albumListItemViewTemplate"),render:function(){return a(this.el).html(this.template(this.model.toJSON())),this},close:function(){a(this.el).unbind(),a(this.el).remove()}}),window.FotoListView=Backbone.View.extend({className:"galeria",template:b("fotoListViewTemplate"),initialize:function(){this.collection.bind("reset",this.render,this),this.render(),this.collection.bind("add",this.add,this)},render:function(){return a(this.el).html(this.template(this.model)),window.c=0,this},add:function(b){var c=new FotoListItemView({model:b});a(".fotos").append(c.render().el),b.attributes.url=="#"+Backbone.history.fragment&&a(".foto a."+b.attributes.id).trigger("click"),window.c<=0&&a(".foto a."+b.attributes.id).trigger("click").addClass("current"),window.c+=1}}),window.FotoListItemView=Backbone.View.extend({tagName:"li",className:"foto",template:b("fotoListItemViewTemplate"),render:function(){return a(this.el).html(this.template(this.model.toJSON())).fadeIn("fast"),this},events:{"click a":"ver"},close:function(){a(this.el).unbind(),a(this.el).remove()},ver:function(b){if(void 0!==b.currentTarget.dataset)var c=b.currentTarget.dataset.src,d=b.currentTarget.dataset.nombre;else var c=b.currentTarget.getAttribute("data-src"),d=b.currentTarget.getAttribute("data-nombre");a(".foto a").removeClass("current"),a(b.currentTarget).addClass("current"),a(".full").fadeOut("fast",function(){a(".full").html('<img src="'+c+'" /><h2>'+d+"</h2>").fadeIn("fast")}),modificar_url(b.currentTarget.href,d),a('<div class="expander"></div>').appendTo(".full").fadeIn("slow").click(function(){screenfull.enabled&&(screenfull.toggle(a(".fancybox-outer")[0]),a(".fancybox-outer").toggleClass("fullscreen"))}),b.preventDefault()}}),window.VideoAlbumListView=Backbone.View.extend({template:b("videoalbumListViewTemplate"),initialize:function(){this.collection.bind("reset",this.render,this),this.collection.bind("add",this.add,this)},render:function(){return a(this.el).html(this.template(this.model.toJSON())).fadeIn("fast"),_.each(this.collection.models,function(b){a(".videoalbumes").append(new VideoAlbumListItemView({model:b}).render().el)},this),this},add:function(){this.render()}}),window.VideoAlbumListItemView=Backbone.View.extend({tagName:"li",className:"videoalbum",template:b("videoalbumListItemViewTemplate"),render:function(){return a(this.el).html(this.template(this.model.toJSON())).fadeIn("fast"),this},close:function(){a(this.el).unbind(),a(this.el).remove()}}),window.VideoListView=Backbone.View.extend({className:"videogaleria",template:b("videoListViewTemplate"),initialize:function(){this.collection.bind("reset",this.render,this),this.render(),this.collection.bind("add",this.add,this)},render:function(){return a(this.el).html(this.template(this.model)).fadeIn("fast"),window.c=0,this},add:function(b){var c=new VideoListItemView({model:b});a(".ivideos").append(c.render().el).fadeIn("slow"),b.attributes.url=="#"+Backbone.history.fragment&&a(".video a."+b.attributes.id).trigger("click"),window.cv<=0&&a(".video a."+b.attributes.id).trigger("click"),window.cv+=1}}),window.VideoListItemView=Backbone.View.extend({tagName:"li",className:"video",template:b("videoListItemViewTemplate"),render:function(){return a(this.el).html(this.template(this.model.toJSON())).fadeIn("fast"),this},events:{"click a":"ver"},close:function(){a(this.el).unbind(),a(this.el).remove()},ver:function(b){if(void 0!==b.currentTarget.dataset)var c=b.currentTarget.dataset.pv,d=b.currentTarget.dataset.id_video,e=b.currentTarget.dataset.nombre;else var c=b.currentTarget.getAttribute("data-pv"),d=b.currentTarget.getAttribute("data-id_video"),e=b.currentTarget.getAttribute("data-nombre");var f=a(".full");"Youtube"==c?f.fadeOut("fast",function(){f.html('<iframe type="text/html" height="80%" width="90%" src="http://www.youtube.com/embed/'+d+'?rel=0" frameborder="0"></iframe><h2>'+e+"</h2>").fadeIn("fast")}):"Vimeo"==c&&f.fadeOut("fast",function(){f.html('<iframe src="http://player.vimeo.com/video/'+d+'" height="80%" width="90%" frameborder="0" webkitAllowFullScreen mozallowfullscreen allowFullScreen></iframe><h2>'+e+"</h2>").fadeIn("fast")}),modificar_url(b.currentTarget.href,e),b.preventDefault()}});var c=Backbone.Router.extend({routes:{imagenes:"listarAlbumes","imagenes/:album(/:foto)":"listarFotos",videos:"listarVideoAlbumes","videos/:videoalbum(/:video)":"listarVideos"},initialize:function(){this.micrositio=new Micrositio,this.micrositio_id=a("#micrositio").data("micrositio-id"),this.micrositio.fetch({data:{id:this.micrositio_id}});var b=new RegExp("(/)+$","g");this.route(/(.*)\/+$/,"trailFix",function(a){a=a.replace(b,""),this.navigate(a,!0)})},listarAlbumes:function(){this.albumList=new AlbumCollection,this.albumList.fetch({data:{micrositio_id:this.micrositio_id}}),this.albumListView=new AlbumListView({collection:this.albumList,model:this.micrositio}),a("#icontainer").html(this.albumListView.render().el)},listarFotos:function(b,c){this.fotoList=new FotoCollection,this.fotoList.fetch({data:{hash:window.location.hash,micrositio:this.micrositio_id},success:function(){var b=a(".full"),c=a(".fancybox-inner").height();b.css("height",c-180),a("#icontainer .galeria .full img").css("max-height",c-228),a(".fotos li").length>8&&(window.slider=a(".fotos").bxSlider({pager:!1,minSlides:1,maxSlides:15,slideWidth:100,slideMargin:8,viewportWidth:"94%"}))}});var d=b.charAt(0).toUpperCase();b=d+b.substring(1),b=makeTitle(b),this.fotoListView=new FotoListView({collection:this.fotoList,model:{nombre:b,foto_activa:c}}),a("#icontainer").html(this.fotoListView.render().el)},listarVideoAlbumes:function(){this.videoalbumList=new VideoAlbumCollection,this.videoalbumList.fetch({data:{micrositio_id:this.micrositio_id}}),this.videoalbumListView=new VideoAlbumListView({collection:this.videoalbumList,model:this.micrositio}),a("#icontainer").html(this.videoalbumListView.render().el)},listarVideos:function(b,c){this.videolist=new VideoCollection,this.videolist.fetch({data:{hash:window.location.hash,micrositio:this.micrositio_id},success:function(){var b=a(".full"),c=a(".fancybox-inner").height();b.css("height",c/1.6),a(".ivideos").wrap('<div id="scroll" style="height: '+c/4+'px;"/>'),a("#scroll").mCustomScrollbar({scrollType:"pixels",scrollButtons:{enable:!0}})}});var d=b.charAt(0).toUpperCase();b=d+b.substring(1),b=makeTitle(b),this.videolistView=new VideoListView({collection:this.videolist,model:{nombre:b,video_activo:c}}),a("#icontainer").html(this.videolistView.render().el)}});new c,Backbone.history.start()});